@model ManageCourseCurriculumViewModel

@{
    var LessonsCount = Model.Modules.Sum(m => m.LessonsCount);
    var ArticleLessonsCount = Model.CurriculumStats.ArticleLessonsCount;
    var VideoLessonsCount = Model.CurriculumStats.VideoLessonsCount;
}

<div class="two-col-layout">
    <div class="section-card">
        <div class="section-header">
            <h3 class="section-title">
                <i class="fas fa-layer-group"></i> Course Modules
            </h3>
            <span class="badge badge-purple" id="lessonCount">@LessonsCount lessons</span>
        </div>
        <div class="section-body">
            <div class="modules-list" id="modulesList">
                <!-- Modules rendered here -->
                @if(LessonsCount < 1)
                {
                    <div class="empty-state">
                        <i class="fas fa-layer-group"></i>
                        <p>No modules yet. Add your first module!</p>
                    </div>
                }
                @foreach(var module in Model.Modules)
                {
                    <div class="module-item" data-module-id="@module.ModuleId" draggable="true">
                        <div class="module-header" data-action="toggle-module">
                            <div class="module-header-left">
                                <div class="module-drag" draggable="true" onmousedown="event.stopPropagation()">
                                    <i class="fas fa-grip-vertical"></i>
                                </div>
                                <div class="module-expand">
                                    <i class="fas fa-chevron-right"></i>
                                </div>
                                <div class="module-info">
                                    <div class="module-title">Module @module.ModuleOrder: <span class="module-title">@module.ModuleTitle</span></div>
                                    <div class="module-meta">@module.LessonsCount lesson@(module.LessonsCount > 1 ? "s" : "") • @module.FormattedLessonDuration</div>
                                </div>
                            </div>
                            <div class="module-actions">
                                <button title="Edit" 
                                    data-action="open-edit-module"
                                    data-module-id="@module.ModuleId" 
                                    data-module-title="@module.ModuleTitle"><i class="fas fa-edit"></i>
                                </button>
                                <button title="Add Lesson" 
                                    data-action="open-add-lesson"
                                    data-module-id="@module.ModuleId"><i class="fas fa-plus"></i>
                                </button>
                                <button class="delete" title="Delete" onclick="deleteModule(@module.ModuleId)"><i class="fas fa-trash"></i></button>
                            </div>
                        </div>
                        <div class="lessons-list" data-module-id="@module.ModuleId">
                            @foreach(var lesson in module.Lessons)
                            {
                                <div class="lesson-item" data-lesson-id="@lesson.LessonId" data-module-id="@module.ModuleId" draggable="true">
                                    <div class="lesson-drag"><i class="fas fa-grip-vertical"></i></div>
                                    <div class="lesson-icon @lesson.ContentType">
                                        <i class="fas fa-@(lesson.ContentType == "video" ? "play-circle" : "file-alt")"></i>
                                    </div>
                                    <div class="lesson-info">
                                        <div class="lesson-title">@lesson.LessonTitle</div>
                                        <div class="lesson-meta">@(lesson.ContentType == "Video" ? "Video" : "Article") • @lesson.FormattedLessonDuration</div>
                                    </div>
                                    <div class="lesson-status">
                                        <div class="lesson-status-dot ${lesson.content ? 'complete' : 'incomplete'}"></div>
                                    </div>
                                    <div class="lesson-actions">
                                        <button title="Edit" 
                                            data-action="open-edit-lesson"
                                            data-module-id="@module.ModuleId"
                                            data-lesson-id="@lesson.LessonId"><i class="fas fa-edit"></i>
                                        </button>
                                        <button class="delete" title="Delete" onclick="deleteLesson(@module.ModuleId, @lesson.LessonId)"><i class="fas fa-trash"></i></button>
                                    </div>
                                </div>
                            }
                            <button class="add-lesson-btn" 
                                data-action="open-add-lesson" 
                                data-module-id="@module.ModuleId"><i class="fas fa-plus"></i> 
                                Add Lesson
                            </button>
                        </div>
                    </div>
                }
            </div>
            <button class="add-module-btn" data-action="open-add-module">
                <i class="fas fa-plus"></i> Add New Module
            </button>
        </div>
    </div>

    <div class="sidebar-panel">
        <!-- Checklist -->
        <div class="panel-card">
            <h4 class="panel-title">
                <i class="fas fa-clipboard-check"></i> Publishing Checklist
            </h4>
            <div id="checklist">
                <div class="checklist-item" data-check="title">
                    <div class="check-icon pending"><i class="fas fa-check"></i></div>
                    <span class="checklist-text">Course title added</span>
                </div>
                <div class="checklist-item" data-check="description">
                    <div class="check-icon pending"><i class="fas fa-check"></i></div>
                    <span class="checklist-text">Course description</span>
                </div>
                <div class="checklist-item" data-check="outcomes">
                    <div class="check-icon pending"><i class="fas fa-check"></i></div>
                    <span class="checklist-text">At least 4 outcomes</span>
                </div>
                <div class="checklist-item" data-check="modules">
                    <div class="check-icon pending"><i class="fas fa-check"></i></div>
                    <span class="checklist-text">At least 1 module</span>
                </div>
                <div class="checklist-item" data-check="lessons">
                    <div class="check-icon pending"><i class="fas fa-check"></i></div>
                    <span class="checklist-text">At least 5 lessons</span>
                </div>
                <div class="checklist-item" data-check="video">
                    <div class="check-icon pending"><i class="fas fa-check"></i></div>
                    <span class="checklist-text">At least 1 video</span>
                </div>
            </div>
        </div>

        <!-- Quick Stats -->
        <div class="panel-card">
            <h4 class="panel-title">
                <i class="fas fa-chart-bar"></i> Course Stats
            </h4>
            <div class="quick-stats">
                <div class="quick-stat">
                    <span class="quick-stat-label">Total Modules</span>
                    <span class="quick-stat-value" id="statModules">@Model.CurriculumStats.TotalModules</span>
                </div>
                <div class="quick-stat">
                    <span class="quick-stat-label">Video Lessons</span>
                    <span class="quick-stat-value" id="statVideos">@VideoLessonsCount</span>
                </div>
                <div class="quick-stat">
                    <span class="quick-stat-label">Article Lessons</span>
                    <span class="quick-stat-value" id="statArticles">@ArticleLessonsCount</span>
                </div>
                <div class="quick-stat">
                    <span class="quick-stat-label">Total Duration</span>
                    <span class="quick-stat-value" id="statDuration">@Model.CurriculumStats.FormattedCourseDuration</span>
                </div>
            </div>
        </div>
    </div>
</div>