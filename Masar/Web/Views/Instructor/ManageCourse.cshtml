@model ManageCourseViewModel

@{
    var IsDraft = Model.CourseStatus == "Draft";
    var IsPending = Model.CourseStatus == "Pending";
    var IsPublished = Model.CourseStatus == "Published";

    var statusBadgeClass = Model.CourseStatus switch
    {
        "Draft" => "badge-orange",
        "Pending" => "badge-cyan",
        "Published" => "badge-green",
        _ => "badge-orange"
    };

    var statusIcon = Model.CourseStatus switch
    {
        "Draft" => "fa-edit",
        "Pending" => "fa-clock",
        "Published" => "fa-check-circle",
        _ => "fa-edit"
    };
}

<!-- Page Header -->
<div class="page-header">
    <div class="page-header-content">
        <div>
            <div class="page-breadcrumb">
                <a href="/instructor/dashboard">Dashboard</a>
                <i class="fas fa-chevron-right"></i>
                <a href="/instructor/my-courses">My Courses</a>
                <i class="fas fa-chevron-right"></i>
                <span id="courseTitleBreadcrumb">@Model.CourseTitle</span>
            </div>
            <h1 class="page-title" id="courseTitleHeader">@Model.CourseTitle</h1>
            <p class="page-subtitle">Manage your course content and settings</p>
        </div>
        <div class="header-actions">
            <a href="/course/@Model.CourseId" target="_blank" class="btn btn-secondary btn-small">
                <i class="fas fa-eye"></i> Preview
            </a>
        </div>
    </div>
</div>

<div class="manage-content">
    <!-- Status Bar -->
    <div class="course-status-bar">
        <div class="status-info">
            <span class="badge @statusBadgeClass" id="courseStatus">
                <i class="fas @statusIcon"></i> @Model.CourseStatus
            </span>
            @if (IsPending)
            {
                <span class="status-message">
                    <i class="fas fa-info-circle"></i> Your course is under review. This usually takes 2-3 business days.
                </span>
            }
            @if (IsPublished)
            {
                <span class="status-message success">
                    <i class="fas fa-check-circle"></i> Your course is live and visible to students.
                </span>
            }
        </div>
        <div class="status-actions">
            @if (IsDraft)
            {
                <button class="btn btn-success btn-small"
                        id="submitBtn"
                        data-action="open-submit-modal">
                    <i class="fas fa-paper-plane"></i> Submit for Review
                </button>
            }
        </div>
    </div>

    <!-- Tabs Navigation (Settings tab removed) -->
    <div class="tabs-nav">
        <button class="tab-btn active" data-tab-id="curriculum" data-action="switch-tab">
            <i class="fas fa-list-alt"></i> Curriculum
        </button>
        <button class="tab-btn" data-tab-id="basics" data-action="switch-tab">
            <i class="fas fa-info-circle"></i> Basic Info
        </button>
        <button class="tab-btn" data-tab-id="outcomes" data-action="switch-tab">
            <i class="fas fa-bullseye"></i> Learning Outcomes
        </button>
    </div>

    <!-- Tab: Curriculum -->
    <div class="tab-content active" id="tab-curriculum" data-tab-id="curriculum">
        @if (Model.Curriculum != null)
        {
            <partial name="_ManageCourseCurriculumPartialView" model="@Model.Curriculum" />
        }
        else
        {
            <div class="empty-state">
                <i class="fas fa-layer-group"></i>
                <p>No curriculum data available.</p>
            </div>
        }
    </div>

    <!-- Tab: Basic Info -->
    <div class="tab-content" id="tab-basics" data-tab-id="basics">
        @if (Model.BasicInfo != null)
        {
            <partial name="_ManageCourseBasicInfoPartialView" model="@Model.BasicInfo" />
        }
        else
        {
            <div class="empty-state">
                <i class="fas fa-info-circle"></i>
                <p>Basic info not available. Please try refreshing the page.</p>
            </div>
        }
    </div>

    <!-- Tab: Learning Outcomes -->
    <div class="tab-content" id="tab-outcomes" data-tab-id="outcomes">
        @if (Model.LearningOutcomes != null)
        {
            <partial name="_ManageCourseLearningOutcomesPartialView" model="@Model.LearningOutcomes" />
        }
        else
        {
            <div class="empty-state">
                <i class="fas fa-bullseye"></i>
                <p>Learning outcomes not available. Please try refreshing the page.</p>
            </div>
        }
    </div>
</div>

<!-- Toast -->
<div class="toast" id="toast">
    <i class="fas fa-check-circle"></i>
    <span id="toastMessage">Changes saved!</span>
</div>

<!-- Add Module Modal -->
<div id="moduleModal" class="modal">
    <div class="modal-overlay" data-action="close-modal" data-target="moduleModal"></div>
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title" id="moduleModalTitle">Add Module</h3>
            <button type="button" class="modal-close" data-action="close-modal" data-target="moduleModal">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <form id="moduleForm">
                <input type="hidden" id="moduleIdInput" name="ModuleId" value="0" />
                <input type="hidden" id="courseIdInput" name="CourseId" value="@Model.CourseId" />

                <div class="form-group">
                    <label for="moduleTitleInput" class="form-label">Module Title *</label>
                    <input type="text" id="moduleTitleInput" name="ModuleTitle" class="form-input" placeholder="Enter the module name" required />
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary danger" data-action="close-modal" data-target="moduleModal">Cancel</button>
            <button type="button" class="btn btn-primary" data-action="save-module">Save Module</button>
        </div>
    </div>
</div>

<!-- Submit for Review Modal -->
<div id="submitModal" class="modal">
    <div class="modal-overlay" data-action="close-modal" data-target="submitModal"></div>
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">Submit for Review</h3>
            <button type="button" class="modal-close" data-action="close-modal" data-target="submitModal">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body" style="text-align: center; padding: 2rem;">
            <div style="width: 70px; height: 70px; background: linear-gradient(135deg, var(--accent-green), var(--accent-cyan)); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.25rem; font-size: 1.75rem; color: white;">
                <i class="fas fa-paper-plane"></i>
            </div>
            <h4 style="font-size: 1.15rem; margin-bottom: 0.6rem;">Ready to Submit?</h4>
            <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 1rem;">
                Your course will be reviewed by our team. This usually takes 2-3 business days.
            </p>
            <p style="color: var(--text-muted); font-size: 0.8rem;">
                Once submitted, you won't be able to make major changes until the review is complete.
            </p>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-action="close-modal" data-target="submitModal">Not Yet</button>
            <button type="button" class="btn btn-success" data-action="confirm-submit">
                <i class="fas fa-check"></i> Submit for Review
            </button>
        </div>
    </div>
</div>

@section Styles {
    <link rel="stylesheet" href="~/css/pages/Instructor/manage-course.css" />
}

@section Scripts {
    <script>
        window.courseData = {
            courseId: @Model.CourseId,
            courseStatus: '@Model.CourseStatus'
        };
    </script>
    <script src="~/js/Instructor/manage-course.js"></script>
}